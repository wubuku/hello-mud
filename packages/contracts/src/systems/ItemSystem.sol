// SPDX-License-Identifier: MIT
pragma solidity >=0.8.24;

/* Autogenerated file. Do not edit manually. */

import { System } from "@latticexyz/world/src/System.sol";
import { Item, ItemData } from "../codegen/index.sol";
import { ItemCreated, ItemUpdated } from "./ItemEvents.sol";
import { ItemCreateLogic } from "./ItemCreateLogic.sol";
import { ItemUpdateLogic } from "./ItemUpdateLogic.sol";
import { SystemRegistry } from "@latticexyz/world/src/codegen/tables/SystemRegistry.sol";
import { NamespaceOwner } from "@latticexyz/world/src/codegen/tables/NamespaceOwner.sol";
import { ResourceId, WorldResourceIdInstance } from "@latticexyz/world/src/WorldResourceId.sol";
import { IAppSystemErrors } from "./IAppSystemErrors.sol";

contract ItemSystem is System, IAppSystemErrors {
  using WorldResourceIdInstance for ResourceId;

  event ItemCreatedEvent(uint32 indexed itemId, bool requiredForCompletion, uint32 sellsFor, string name);

  event ItemUpdatedEvent(uint32 indexed itemId, bool requiredForCompletion, uint32 sellsFor, string name);

  function _requireNamespaceOwner() internal view {
    ResourceId _thisSystemId = SystemRegistry.get(address(this));
    address _thisNamespaceOwner = NamespaceOwner.get(_thisSystemId.getNamespaceId());
    if (_thisNamespaceOwner != _msgSender()) {
      revert RequireNamespaceOwner(_msgSender(), _thisNamespaceOwner);
    }
  }

  function itemCreate(uint32 itemId, bool requiredForCompletion, uint32 sellsFor, string memory name) public {
    _requireNamespaceOwner();
    ItemData memory itemData = Item.get(itemId);
    if (!(itemData.requiredForCompletion == false && itemData.sellsFor == uint32(0) && bytes(itemData.name).length == 0)) {
      revert ItemAlreadyExists(itemId);
    }
    ItemCreated memory itemCreated = ItemCreateLogic.verify(itemId, requiredForCompletion, sellsFor, name);
    itemCreated.itemId = itemId;
    emit ItemCreatedEvent(itemCreated.itemId, itemCreated.requiredForCompletion, itemCreated.sellsFor, itemCreated.name);
    ItemData memory newItemData = ItemCreateLogic.mutate(itemCreated);
    Item.set(itemId, newItemData);
  }

  function itemUpdate(uint32 itemId, bool requiredForCompletion, uint32 sellsFor, string memory name) public {
    _requireNamespaceOwner();
    ItemData memory itemData = Item.get(itemId);
    if (itemData.requiredForCompletion == false && itemData.sellsFor == uint32(0) && bytes(itemData.name).length == 0) {
      revert ItemDoesNotExist(itemId);
    }
    ItemUpdated memory itemUpdated = ItemUpdateLogic.verify(itemId, requiredForCompletion, sellsFor, name, itemData);
    itemUpdated.itemId = itemId;
    emit ItemUpdatedEvent(itemUpdated.itemId, itemUpdated.requiredForCompletion, itemUpdated.sellsFor, itemUpdated.name);
    ItemData memory updatedItemData = ItemUpdateLogic.mutate(itemUpdated, itemData);
    Item.set(itemId, updatedItemData);
  }

}
