singletonObjects:
  Map:
    metadata:
      Preprocessors: [ "CRUD_IT" ]
      #CRUD_IT_NO_UPDATE: true
      CRUD_IT_NO_DELETE: true
      # TrustFriendsAsAccountDelegatees: true
    friends:
      - Player.ClaimIsland
      - Player.GatherIslandResources
    properties:
      Existing:
        type: bool
      IslandClaimWhitelistEnabled:
        type: bool
      IslandResourceRenewalQuantity:
        # previous hardcoded value as ISLAND_RESOURCE_REGENERATION_QUANTITY
        type: uint32
      IslandResourceRenewalTime:
        # previous hardcoded value as ISLAND_RESOURCE_REGENERATION_TIME
        type: uint64
      IslandRenewableItemIds:
        # MUD Store does not provide native traversal of all records in a table.
        # We need a place to record what keys the "IslandRenewableItem" table has.
        type: uint32[]
      Locations:
        itemType: MapLocation

    entities:
      MapLocation:
        # This is an internal entity
        id:
          name: Coordinates
          type: Coordinates
        properties:
          Type:
            type: u32
          OccupiedBy:
            type: u256 # PlayerId
          GatheredAt:
            type: u64
          Existing:
            type: bool
            # Set to true when the location is created
          ResourcesItemIds:
            description: "Island initial resource item IDs"
            type: uint32[]
          ResourcesQuantities:
            description: "Island initial resource quantities"
            type: uint32[]

    methods:
      Create:
        requiredPermission: __NamespaceOwner__ # "__Publisher__"
      Update:
        requiredPermission: __NamespaceOwner__ # "__Publisher__"

      AddIsland:
        requiredPermission: __NamespaceOwner__ #requiredPermission: "AdminCap"
        parameters:
          Coordinates:
            type: Coordinates
          Resources:
            itemType: ItemIdQuantityPair
        event:
          name: IslandAdded

      AddMultiIslands:
        requiredPermission: __NamespaceOwner__ #requiredPermission: "AdminCap"
        parameters:
          Coordinates:
            itemType: Coordinates
          ResourceItemIds:
            description: "Resource item IDs of each island"
            type: uint32[]
          ResourceSubtotal:
            description: "Resource subtotal quantity of each island"
            type: uint32
        event:
          name: MultiIslandsAdded

      ClaimIsland:
        metadata:
          IsOnlyOpenToFriends: true
          # IsCallFromEnabled: true
        # isInternal: true
        parameters:
          Coordinates:
            type: Coordinates
          ClaimedBy:
            type: u256 # PlayerId
            description: The player (Id) that is claiming the island
          ClaimedAt:
            type: u64
            description: The timestamp (unix epoch time in seconds) of the claim
        event:
          name: MapIslandClaimed

      GatherIslandResources:
        metadata:
        #   ParametersIncludedInMutationFunction: [ "Clock" ]
          IsOnlyOpenToFriends: true
          # IsCallFromEnabled: true
        # isInternal: true
        parameters:
          #Player:
          #  referenceType: Player
          #  isMutableReference: true
          #  isIgnoredInEvent: true
          PlayerId:
            type: u256 # ID
          Coordinates:
            type: Coordinates
            description: The coordinates of the island to gather resources from
          #Clock:
          #  referenceType: Clock
          #  isIgnoredInEvent: true
        result:
          name: GatheredResources
          itemType: ItemIdQuantityPair
        event:
          name: IslandResourcesGathered
          properties:
            GatheredAt:
              type: u64
            Coordinates:
              type: Coordinates
            Resources:
              itemType: ItemIdQuantityPair
